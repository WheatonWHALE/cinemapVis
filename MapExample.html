<!DOCTYPE html>
<html>
  <head>
    <meta name="viewport" content="initial-scale=1.0, user-scalable=no" />
    <meta charset="utf-8">
    <style>
      /*html { height: 100% }
      body { height: 100%; margin: 0; padding: 0 }
      #map-canvas { height: 100% }*/
       html, body, #map-canvas {
        height: 100%;
        margin: 0px;
        padding: 0px
      }
      /*#panel {
        position: absolute;
        top: 5px;
        left: 50%;
        margin-left: -180px;
        z-index: 5;
        background-color: #fff;
        padding: 5px;
        border: 1px solid #999;
      }*/
    </style>
    
    <script src="https://maps.googleapis.com/maps/api/js?v=3.exp&sensor=false"></script>
    <script src="jquery-1.11.1.min.js"></script>
    <!--<script type="text/javascript"
      src="https://maps.googleapis.com/maps/api/js?key=AIzaSyCzk427UkCDu0YqwZKEY0hh_5685wBXykY&sensor=fales">
    </script> -->
    
    <script type="text/javascript">
    var geocoder;
    var map;
    var TheaterAddress =  [
                        "700 South Main Street, Sharon, MA",
                        "24 Patriot Place, Foxboro, MA",
                        "640 South Washington Street, North Attleboro, MA",
                        "2 Galleria Mall Drive, Taunton, MA",
                        "207 Swansea Mall Drive, Swansea, MA",
                        "100 Commerce Way, Seekonk, MA",
                        "652 East Washington St., North Attleboro, MA",
                        "60 Newport Avenue, Rumford, RI",
                        "73 Mazzeo Drive, Randolph, MA" 
                      ];

      function initialize() {
        geocoder = new google.maps.Geocoder();
        var myLatlng = new google.maps.LatLng(39.571822, -98.964844);
        var mapOptions = {
          zoom: 3,
          center: myLatlng
        }; // ends Mapoption
        
        map = new google.maps.Map(document.getElementById("map-canvas"), mapOptions);

        // for (var i = 0; i < TheaterAddress.length; i++) {
        //   geocodeThatAddress(TheaterAddress[i])
        // };

        $.getJSON("http://infinite-citadel-8572.herokuapp.com/api/0.1/showings/", function( showingData ){
            for (var i = 0; i < showingData.length; i++) {
              //geocodeThatAddress(data[i]);
              getVenueData(showingData[i]);
            }; // ends for loop
        }); // ends function

        function getVenueData (showing) {
          //console.log("http://infinite-citadel-8572.herokuapp.com/api/0.1/venues/" + showing.venue_id);
          $.getJSON("http://infinite-citadel-8572.herokuapp.com/api/0.1/venues/" + showing.venue_id, function( veuneData ){
            getFeatureData(showing, veuneData);
          });
        };

        function getFeatureData (showing, veuneData) {
          //console.log("http://infinite-citadel-8572.herokuapp.com/api/0.1/features/" + showing.feature_id);
          $.getJSON("http://infinite-citadel-8572.herokuapp.com/api/0.1/features/" + showing.feature_id, function(featureData){
            geocodeThatAddress(showing, veuneData, featureData);
          });
        };



        // To add the marker to the map, use the 'map' property
        // var maxLat = 90;
        // var minLat = -90;
        // var maxLong = 180;
        // var minLong = -180;

        // for (var i = 0; i < 100; i++) {
        //   var Lat = (Math.random() * (maxLat - minLat) + minLat);
        //   var Long = (Math.random() * (maxLong - minLong) + minLong);
        //   var myLatlng = new google.maps.LatLng(Lat, Long);

        //   var marker = new google.maps.Marker({
        //     position: myLatlng,
        //     map: map,
        //     title: "Latitude: "+ Lat + " Lonitude: " + Long 
        //   }); // ends Marker 
        // }; // ends for loop   
      };// end function
      

      // function codeAddress() {
      //   var address = document.getElementById("address").value;
      //   geocoder.geocode( { 'address': address}, function(results, status) {
      //     if (status == google.maps.GeocoderStatus.OK) {
      //       map.setCenter(results[0].geometry.location);
      //       var marker = new google.maps.Marker({
      //         map: map,
      //         position: results[0].geometry.location
      //       });
      //     } 
      //     else {
      //       alert("Geocode was not successful for the following reason: " + status);
      //     }
      //   });
      // }

      function geocodeThatAddress(showing, veuneData, featureData) {
        //console.log(showing);
        // if (veuneData.address.city === "Randolph"){
        //   console.log(veuneData);
        // }
          geocoder.geocode( {'address' : veuneData.address.street +" "+ veuneData.address.city +" "+ veuneData.address.state}, function(results, status) {
            if (status == google.maps.GeocoderStatus.OK) {
             map.setCenter(results[0].geometry.location);
              var marker = new google.maps.Marker({
                map: map,
                position: results[0].geometry.location,
                title: "Theater name: " + veuneData.name + " || Address: " + veuneData.address.street + " " + veuneData.address.city + " " + veuneData.address.state + " || Feature: " + featureData.title + " || Show Time: " + showing.showtime 
              });
            } 
          else {
            alert("Geocode was not successful for the following reason: " + status);
          }
        });
      }

    google.maps.event.addDomListener(window, 'load', initialize);
    </script>
  
  </head>
    <body>
      <!-- <div id="panel">
        <input id="address" type="textbox" value="Sydney, NSW">
        <input type="button" value="Geocode" onclick="codeAddress()">
      </div> -->
      <div id="map-canvas"></div>
    </body>
</html>